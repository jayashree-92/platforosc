USE HM_WIRES;

IF EXISTS( SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'hmsWires' AND COLUMN_NAME = 'CreatedAt' AND DATA_TYPE='datetime')
BEGIN

	DECLARE @ConstraintName nvarchar(200)
	SELECT @ConstraintName=name FROM SYS.DEFAULT_CONSTRAINTS WHERE PARENT_OBJECT_ID = OBJECT_ID('hmsWires') AND PARENT_COLUMN_ID = (SELECT column_id FROM sys.columns WHERE NAME = N'CreatedAt' AND object_id = OBJECT_ID(N'hmsWires'))
	IF @ConstraintName IS NOT NULL
	EXEC('ALTER TABLE hmsWires DROP CONSTRAINT ' + @ConstraintName);

	ALTER TABLE hmsWires ALTER COLUMN CreatedAt DATETIMEOFFSET NOT NULL ;
END
IF EXISTS( SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'hmsWires' AND COLUMN_NAME = 'LastModifiedAt'  AND DATA_TYPE='datetime')
BEGIN
	DECLARE @ConstraintName2 nvarchar(200)
	SELECT @ConstraintName2=name FROM SYS.DEFAULT_CONSTRAINTS WHERE PARENT_OBJECT_ID = OBJECT_ID('hmsWires') AND PARENT_COLUMN_ID = (SELECT column_id FROM sys.columns WHERE NAME = N'LastModifiedAt' AND object_id = OBJECT_ID(N'hmsWires'))
	IF @ConstraintName2 IS NOT NULL
	EXEC('ALTER TABLE hmsWires DROP CONSTRAINT ' + @ConstraintName2);

	ALTER TABLE hmsWires ALTER COLUMN  LastModifiedAt DATETIMEOFFSET NOT NULL ;
END
IF EXISTS( SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'hmsWires' AND COLUMN_NAME = 'ApprovedAt'  AND DATA_TYPE='datetime')
BEGIN
	ALTER TABLE hmsWires ALTER COLUMN  ApprovedAt DATETIMEOFFSET  NULL ;
END


IF EXISTS( SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'hmsWireWorkflowLog' AND COLUMN_NAME = 'CreatedAt'  AND DATA_TYPE='datetime')
BEGIN
	DECLARE @ConstraintName3 nvarchar(200)
	SELECT @ConstraintName3=name FROM SYS.DEFAULT_CONSTRAINTS WHERE PARENT_OBJECT_ID = OBJECT_ID('hmsWireWorkflowLog') AND PARENT_COLUMN_ID = (SELECT column_id FROM sys.columns WHERE NAME = N'CreatedAt' AND object_id = OBJECT_ID(N'hmsWireWorkflowLog'))
	IF @ConstraintName3 IS NOT NULL
	EXEC('ALTER TABLE hmsWireWorkflowLog  DROP CONSTRAINT ' + @ConstraintName3);

	ALTER TABLE hmsWireWorkflowLog ALTER COLUMN  CreatedAt DATETIMEOFFSET NOT NULL ;
END